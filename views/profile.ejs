<!doctype html>
<html lang="pt-br">

<head>

	<title>Rede+Cientistas ::: Perfil</title>
	<link rel="icon" th:href="@{/image/favicon.ico}" />
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="description" content="Rede Social para Cientistas" />
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
		integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
	<link rel="stylesheet" href="/css/profile.css" type="text/css">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
	<script src="/js/cidades-estados.js"></script>

</head>
<%- include('partials/header-profile') -%>
<div class="container-fluid">
	<div class="row h-100">
		<div class="col-8 h-100 border-right">
			<h2 class="display-4 text-center py-4">Timeline</h2>
			<% user.forEach(function(user){ %>
			<form action="/profile/<%= user.email %>/uploadArquivo" method="POST" enctype="multipart/form-data">
				<div class="card shadow mb-5 mx-4">
					<div class="card-body">
						<h3>Criar Publicação</h3>
						<div class="input-group-append">
							<input type="text" id="newPubl[publTitle]" name="newPubl[publTitle]" class="form-control mb-2 pb-2"
								placeholder="Título da Publicação" autofocus required>
							</div>
							<div class="form-group">
								<label for="estado">Estado</label>
								<select class="custom-select" id="publ[state]" name="publ[state]" required>
									<option>...</option>
								</select>
							</div>
							<div class="form-group">
								<label for="cidade">Cidade</label>
								<select class="custom-select" id="publ[city]" name="publ[city]" required>
									<option>...</option>
								</select>
							</div>
							<script language="JavaScript" type="text/javascript" charset="utf-8">
								new dgCidadesEstados({
									cidade: document.getElementById('publ[city]'),
									estado: document.getElementById('publ[state]')
								})
							</script>
						<div class="form-group">
							<label for="data" class="control-label"></label>
							<input type="date" id="newPubl[publData]" name="newPubl[publData]" placeholder="Data" class="form-control" autofocus required>
						</div>
						<div class="input-group-append">
							<input type="text" id="newPubl[publUrl]" name="newPubl[publUrl]" class="form-control mb-2 pb-2"
								placeholder="URL" autofocus required>
							</div>
						<div class="custom-file mb-3 mt-3">
							<input type="file" class="custom-file-input" name="newPubl[file]" id="newPubl[file]"
								onchange="readSingleFile(this.files)">
							<label class="custom-file-label" for="newPubl[file]" id="file-label">Escolha um arquivo</label>
						</div>
						<div class="input-group postBox">
							<input type="text" id="newPubl[authorName]" name="newPubl[authorName]" class="form-control"
								style="display:none" value="<%= user.name %>" autofocus required>
							<input type="text" id="newPubl[authorEmail]" name="newPubl[authorEmail]"
								class="form-control" style="display:none" value="<%= user.email %>" autofocus required>
							<textarea id="newPubl[publText]" name="newPubl[publText]" class="form-control" placeholder="Descrição da Publicação"
								aria-label="With textarea"></textarea>
							<div class="input-group-append postBox">
								<button type="submit" class="input-group-text"><i
										class="fas fa-paper-plane px-3"></i></button>
							</div>
						</div>
			</form>
		</div>
	</div>
	</form>
	<form action="/profile/<%= user.email %>" method="POST">
		<div class="card shadow mb-5 mx-4">
			<div class="card-body">
				<h3>Criar Post</h3>
				<div class="input-group postBox">
					<input type="text" id="newpost[authorName]" name="newpost[authorName]" class="form-control"
						style="display:none" value="<%= user.name %>" autofocus required>
					<input type="text" id="newpost[authorEmail]" name="newpost[authorEmail]" class="form-control"
						style="display:none" value="<%= user.email %>" autofocus required>
					<textarea id="newpost[postText]" name="newpost[postText]" class="form-control"
						aria-label="With textarea"></textarea>
					<div class="input-group-append postBox">
						<button type="submit" class="input-group-text"><i class="fas fa-paper-plane px-3"></i></button>
					</div>
				</div>
			</div>
		</div>
	</form>
	<% }); %>

	<% posts.forEach(function(post){ %>
	<div class="card shadow mb-5 mx-4">
		<div class="card-body">
			<div class="media">
				<% user.forEach(function(user){ %>
				<img src="<%= user.image %>" class="align-self-center mr-4 shadow rounded-circle timeline-profile-image"
					alt="">
				<div class="media-body">
					<h5 class="mt-0 mb-0"><%= user.name %></h5>
					<p style="font-size: 0.8em;">
						<%= post.created.toDateString()+" - "+ (post.created.toTimeString()).substring(0,9) %>
					</p>
					<p contenteditable="false" id="post[text]" name="post[text]" class="mb-0">
						<%= post.postText %></p>
					<label class="mt-5"><i class="fas fa-thumbs-up mr-2"></i><%= post.likes.length %></label>
				</div>
				<div class="d-flex flex-column">

					<form action="/profile/<%= user.email %>/like/<%= post.id %>?_method=PUT" method="POST">
						<input type="text" id="post[id]" name="post[id]" class="form-control" style="display:none"
							value="<%= post.id %>">
						<button type="submit" action="" class="btn btn-primary m-2"><i
								class="far fa-thumbs-up "></i></button>
					</form>
					<input type="text" id="post[id]" name="post[id]" class="form-control" style="display:none"
						value="<%= post.id %>" autofocus required>
					<a href="/profile/<%= user.email %>/post/<%= post.id %>/edit/" id="btnEdit" onClick=" "
						class="btn btn-secondary m-2"><i id="btnEditImage" class="far fa-edit "></i></a>
					</form>

					<form action="/profile/<%= user.email %>?_method=DELETE" method="POST">
						<% }); %>
						<input type="text" id="post[id]" name="post[id]" class="form-control" style="display:none"
							value="<%= post.id %>" autofocus required>
						<button type="submit" class="btn btn-danger m-2"><i class="far fa-trash-alt px-1"></i></button>
					</form>
				</div>
			</div>
		</div>
	</div>
	<% }); %>



</div>


<div class="col-4 h-100">
	<h2 class="display-4 text-center py-4">Perfil</h2>
	<div class="card py-5">
		<% user.forEach(function(user){ %>
		<div class="card-body d-flex flex-column">
			<img src="<%= user.image %>" class="align-self-center shadow rounded-circle profile-image" alt="">
			<h4 id="username" name="username" class="text-center py-2"><%= user.name %></h4>
			<p id="email" name="email" class="text-center m-0"><%= user.email %></p>
			<p id="idade" class="text-center m-0"><%= user.age %></p>
			<p id="cidade-estado" class="text-center m-0"><%= user.city %>,<%= user.state %></p>
			<p id="nivel-curso" class="text-center m-0"><%= user.formacao %> <%= user.course %></p>
			<p id="universidade" class="text-center m-0"><%= user.university %></p>
			<% if (user.inicDados) { %>
			<% var data = user.inicDados %>
			<% var datac = moment(data).format("DD/MM/YYYY") %>
			<p id="inic-dados" class="text-center m-0">Começou a estudar Ciência de dados em <%= datac %> em
				<%= user.instPesquisa %></p>
			<% }; %>
			<label id="Curriculum Lates" class="text-center pt-2 "><a href="<%= user.curriculum %>">Visitar
					Curriculo</a></label>
			<div style="display: none;"><%= userid = user._id %>
				<% userFriends = user.friends %></div>
		</div>
		<% }); %>
	</div>

</div>
</div>
</div>



<!-- Fonts Awesome -->
<script src="https://kit.fontawesome.com/3741ec6fe2.js" crossorigin="anonymous"></script>
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
	integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
	crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
	integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
	crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"
	integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI"
	crossorigin="anonymous"></script>
	<script>
		function readSingleFile(e) {
			const name = e[0].name;
			document.getElementById("file-label").textContent = name;
		}
	</script>

</body>

</html>